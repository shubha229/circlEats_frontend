<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CirclEats | Shelter Dashboard</title>
<link rel="icon" href="assets/logo.jpg">
<style>
body { margin:0; font-family:"Inter",sans-serif; background:linear-gradient(135deg,#e0f2fe,#ecfdf5,#f0fdf4); color:#1f2937; }
header.navbar { background-color:#ffffff; box-shadow:0 1px 6px rgba(0,0,0,0.05); position:sticky; top:0; z-index:100; }
.navbar nav { display:flex; justify-content:space-between; align-items:center; padding:0.8rem 1.5rem; }
.brand { display:flex; align-items:center; gap:0.6rem; }
.brand img { width:42px; height:42px; border-radius:0.5rem; }
.brand span { font-weight:700; color:#0f766e; font-size:1.3rem; }
.nav-btn { padding:0.45rem 0.9rem; border-radius:0.5rem; background:none; border:none; font-weight:500; cursor:pointer; color:#0f172a; transition:all 0.2s ease; }
.nav-btn:hover { background-color:#f3f4f6; }
.nav-btn.active { background-color:#0f766e; color:white; }
.lang-select { border:1px solid #d1d5db; border-radius:0.375rem; padding:0.25rem 0.5rem; font-size:0.85rem; }
h1 { font-size:2.5rem; font-weight:800; color:#0f766e; margin:0.5rem 0; text-align:center; }
main { max-width:900px; margin:auto; padding:1rem; }
.card { background:#ffffffb3; backdrop-filter:blur(8px); border:1px solid #bbf7d0; border-radius:1rem; padding:1.5rem; box-shadow:0 4px 10px rgba(0,0,0,0.05); margin-bottom:1.5rem; }
#map { width:100%; height:350px; border-radius:0.75rem; border:1px solid #d1d5db; }
button.accept-btn { background:#0f766e; color:#fff; border:none; padding:0.6rem 1.2rem; border-radius:0.6rem; cursor:pointer; font-weight:600; transition:0.25s; }
button.accept-btn:hover { background:#115e59; }
footer { text-align:center; color:#6b7280; padding:1rem; border-top:1px solid #e5e7eb; margin-top:2rem; }
</style>
</head>

<body>
<header class="navbar">
<nav>
  <div class="brand"><img src="assets/logo.jpg" alt="CirclEats Logo"><span>CirclEats</span></div>
  <div>
    <button onclick="window.location.href='dvs.html'" class="nav-btn">Donor</button>
    <button onclick="window.location.href='volunteer.html'" class="nav-btn">Volunteer</button>
    <button class="nav-btn active">Shelter</button>
    <button onclick="window.location.href='user-dashboard.html'" class="nav-btn">Profile</button>
  </div>
  <select id="lang-select" class="lang-select">
    <option value="en">English</option>
    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
    <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
  </select>
</nav>
</header>

<section class="py-6">
  <h1>Shelter Dashboard</h1>
</section>

<main>
  <div class="card">
    <h2>üìç Select Shelter Location</h2>
    <div id="map"></div>
    <p style="font-size:.9rem;color:#6b7280;margin-top:.5rem;text-align:center;">Click on map to set shelter location.</p>
  </div>

  <div class="card">
    <h2>üç± Food Ready for Donation</h2>
    <div id="availableDonations">Loading available donations‚Ä¶</div>
  </div>
</main>

<footer>¬© 2025 CirclEats | Nourishing Communities üíö</footer>

<script>
// üåê Replace this with your deployed backend URL on Render:
const BASE_URL = "https://circleats-backend.onrender.com";

// ü•ó Load only pending donations
async function loadAvailableDonations() {
  try {
    const res = await fetch(`${BASE_URL}/api/donations`);
    const data = await res.json();
    const container = document.getElementById("availableDonations");
    container.innerHTML = "";

    const pending = data.filter(d => d.status === "Pending" && !d.collected_by && !d.donated_to);
    if (!pending.length) {
      container.innerHTML = `<p style='color:#6b7280;text-align:center;'>No food donations available right now.</p>`;
      return;
    }

    pending.forEach(donation => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <h3 style="color:#0f766e;font-weight:700;">${donation.item || "Unnamed Food"} (${donation.quantity || "N/A"})</h3>
        <p>üìç ${donation.location || "Unknown location"}</p>
        <button class="accept-btn" onclick="acceptFood('${donation._id}')">Accept This Food</button>
      `;
      container.appendChild(div);
    });
  } catch (err) {
    console.error("Error fetching donations:", err);
  }
}

// ‚úÖ Shelter accepts a donation
async function acceptFood(id) {
  const location = prompt("Enter your shelter location:");
  const email = localStorage.getItem("email");
  if (!email || !location) {
    alert("Shelter email or location missing!");
    return;
  }

  const res = await fetch(`${BASE_URL}/api/shelter_request/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ shelter: email, location })
  });

  const result = await res.json();
  alert(result.message);
  loadAvailableDonations();
}

// üîî Notification polling
async function fetchNotifications() {
  const email = localStorage.getItem("email");
  if (!email) return;
  const res = await fetch(`${BASE_URL}/api/notifications/${email}`);
  const data = await res.json();
  if (data.length) showToast(data[data.length - 1].message);
}

// üí¨ Toast display
function showToast(msg) {
  const toast = document.createElement("div");
  toast.textContent = msg;
  Object.assign(toast.style, {
    position: "fixed",
    bottom: "30px",
    right: "30px",
    background: "#0f766e",
    color: "white",
    padding: "12px 18px",
    borderRadius: "8px",
    fontWeight: "600",
    boxShadow: "0 4px 10px rgba(0,0,0,0.15)",
    zIndex: "9999"
  });
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 4000);
}

setInterval(fetchNotifications, 15000);
loadAvailableDonations();
</script>
</body>
</html>
